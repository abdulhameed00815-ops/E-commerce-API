<!DOCTYPE html>
<html>
        <head>
                <title>homepage</title>
                <link rel="stylesheet" type="text/css" href="elements.css?v=123">
        </head>
        <body>
		<div class="top-panel">
		<h1>Lamazon</h1>
		<form id="search-bar">
			<div class="form-group1">
				<input type="text" placeholder="Search products" id="searched-product">
			</div>

			<input type="submit" class="button" id="search-button" value="Search Lamazon">
		</form>
		</div>
		<div id="productDiv">
			<div id="product-image"></div>
		<h2 id='output'></h2>
		</div>
	</body>
	<script>
		document.getElementById('search-button').addEventListener('click', searchProduct);
		
		function searchProduct(e){
			e.preventDefault()
			const product = document.getElementById('searched-product').value;	
			const token = localStorage.getItem("access_token");
			const output = document.getElementById('output');
			fetch(`http://127.0.0.1:8000/searchproducts/${product}`, {
				method: 'GET',
				headers: {
					"Authorization": `Bearer ${token}`
				}
			})
			.then(res => {
                                return res.json().then(data => ({ status: res.status, data: data }));
                        })
                        .then(({ status, data }) => {
                                if (status === 200) {
					const productImage = document.getElementById('product-image');
					productImage.classList.add('productImage');
					const productDiv = document.getElementById('productDiv');
					productDiv.classList.add('product');
					output.innerHTML = `
						<ul>
							<li>${data.name}</li>
							<li>Price: ${data.price}</li>
						</ul>
						<button id="cart-button" class="buttonCart">Add to cart</button>
						<button id="checkout-button" class="buttonChechout">Checkout</button>
						<h3 id="cart-output"></h3>

					`;
							
					document.getElementById('cart-button').addEventListener('click', AddToCart);

					function AddToCart(e){
						e.preventDefault();
						const product = document.getElementById('searched-product').value;	
						fetch('http://127.0.0.1:8000/addtocart/', { 
							method: 'POST',
							headers: {
								"Authorization": `Bearer ${token}`,
								"Accept": 'application/json, text/plain, */*',
								"Content-type": 'application/json'
							},
							body:JSON.stringify({product_name:product})
						})
						.then(res => {
							return res.json().then(data => ({ status: res.status, data: data }));
						})
						.then(({ status, data }) => {
							if (status === 200) {
								const output = document.getElementById('cart-output');
								output.classList.add('output');
								output.innerHTML = data.message;
								setTimeout(() => output.remove(), 3000);
							} else {
								window.location.reload()
								output.innerHTML = data.detail;
								setTimeout(() => output.remove(), 5000);

							}
						});
					};

					document.getElementById('checkout-button').addEventListener('click', checkout);

					function checkout(e){
						e.preventDefault();
						window.location.assign('http://localhost:5500/checkout.html');
					};
				} else {
 					window.location.reload()
					output.innerHTML = data.detail;
                                        setTimeout(() => output.remove(), 5000);

				}
			});
		}

	</script>
</html>

